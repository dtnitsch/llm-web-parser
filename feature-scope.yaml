system:
  name: llm_web_parser
  purpose: >
    Deterministic, LLM-friendly web page parsing system that converts raw HTML
    into structured, citation-ready, confidence-scored content. Designed to
    replace "deep search" style scraping with predictable, auditable outputs
    usable by LLMs and engineers alike.

inputs:
  parse_request:
    description: Primary invocation contract for all parsing operations.
    fields:
      url:
        type: string
        required: true
        description: Canonical URL of the page being parsed.
      html:
        type: string
        required: false
        description: Optional raw HTML. If omitted, upstream fetcher is assumed.
      mode:
        type: enum
        values: [cheap, full]
        default: cheap
        description: Controls parsing depth and cost.
      max_depth:
        type: int
        required: false
        description: >
          Hint for crawl or extraction depth. Any value >0 forces full mode.
      extract_links:
        type: bool
        default: true
        description: Whether to extract and classify links per block.
      require_citations:
        type: bool
        default: false
        description: Forces full mode to guarantee block-level IDs for citation.

parse_modes:
  cheap:
    description: >
      Fast, low-cost parse intended for summarization, relevance checks,
      lightweight RAG ingestion, and pre-filtering.
    characteristics:
      - Uses readability-style main content extraction
      - Limited DOM traversal
      - No deep semantic reconstruction
    supported_features:
      - headings (h1–h3)
      - paragraphs
      - basic block confidence
      - block IDs
      - section grouping
      - link extraction (internal vs external)
    excluded_features:
      - tables
      - code blocks
      - list item fidelity
      - fine-grained semantic typing

  full:
    description: >
      High-fidelity parse intended for citation, analysis, agent reasoning,
      and long-term storage.
    characteristics:
      - Full DOM traversal
      - Semantic block detection
      - Structural preservation
    supported_features:
      - all cheap mode features
      - tables
      - code blocks
      - lists (ordered/unordered)
      - richer confidence scoring
      - future extensibility hooks

page_model:
  page:
    fields:
      url:
        description: Canonical URL of the page.
      title:
        description: Best-effort extracted page title.
      content:
        description: Ordered list of content blocks.
      metadata:
        optional: true
        description: Page-level metadata (word count, language, etc. – future).

content_blocks:
  description: Atomic semantic units emitted by the parser.
  fields:
    id:
      type: string
      description: Stable, per-page unique block identifier (for citations).
    type:
      type: enum
      examples: [h1, h2, h3, p, li, table, code]
      description: Semantic classification of the block.
    text:
      type: string
      description: Normalized, human-readable text content.
    section:
      type: string
      description: >
        Logical section heading this block belongs to (derived from nearest
        heading ancestor).
    confidence:
      type: float
      range: [0.0, 1.0]
      description: Heuristic confidence score estimating content quality.
    links:
      type: list
      description: Links extracted from this block.
      fields:
        href:
          description: Resolved absolute URL.
        text:
          description: Anchor text.
        classification:
          enum: [internal, external]
          description: Based on hostname comparison with page URL.

confidence_heuristics:
  description: Lightweight scoring to help LLMs prioritize content.
  signals:
    - text length (very short blocks penalized)
    - block type (headings slightly boosted)
    - link density (excessive links penalized)
    - boilerplate indicators (future)
  intent: >
    Confidence is advisory, not absolute. Designed to guide LLM attention,
    summarization weighting, and citation selection.

link_handling:
  extraction:
    per_block: true
    description: Links are extracted at the block level, not page level.
  classification:
    method: hostname comparison
    internal: same host as page URL
    external: different host
  use_cases:
    - source attribution
    - crawl decisions
    - trust heuristics

citations:
  support:
    enabled: true
  mechanism:
    description: >
      Each content block has a stable ID, allowing LLMs to reference
      specific passages deterministically.
  guarantee:
    require_citations: forces full parse

extensibility_notes:
  designed_for:
    - LLM agents (Claude, Gemini, ChatGPT, local models)
    - Deterministic RAG pipelines
    - Auditable research workflows
  future_additions:
    - language detection
    - reading time estimation
    - block embeddings
    - boilerplate detection
    - multi-page crawl orchestration

philosophy:
  goals:
    - predictable outputs
    - minimal token waste
    - explicit tradeoffs between cost and fidelity
    - LLM-readable AND engineer-debuggable
  non_goals:
    - pixel-perfect rendering
    - browser emulation
    - heuristic-heavy ML classification

